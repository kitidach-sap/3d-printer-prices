<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin ‚Äî 3D Printer Prices</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-wrap {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .admin-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Tabs */
        .admin-tabs {
            display: flex;
            gap: 0.25rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
            overflow-x: auto;
        }

        .admin-tab {
            padding: 0.6rem 1.2rem;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-muted);
            border: none;
            background: none;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .admin-tab:hover {
            color: var(--text-primary);
        }

        .admin-tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .admin-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .admin-card h3 {
            font-size: 0.95rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }

        /* Grid info */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .info-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: 700;
        }

        /* Buttons */
        .btn {
            border: none;
            border-radius: var(--radius-sm);
            padding: 0.6rem 1.2rem;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #0891b2);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn.running {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        /* Tables */
        .admin-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }

        .admin-table th {
            text-align: left;
            padding: 0.45rem 0.6rem;
            color: var(--text-muted);
            font-size: 0.68rem;
            text-transform: uppercase;
            border-bottom: 2px solid var(--border);
        }

        .admin-table td {
            padding: 0.45rem 0.6rem;
            border-bottom: 1px solid var(--border);
        }

        .status-success {
            color: var(--success);
            font-weight: 600;
        }

        .status-failed {
            color: var(--danger);
            font-weight: 600;
        }

        .status-partial {
            color: var(--warning);
            font-weight: 600;
        }

        /* Forms */
        .form-group {
            margin-bottom: 0.75rem;
        }

        .form-group label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 0.3rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.85rem;
            font-family: inherit;
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        #status-msg,
        #blog-status {
            margin-top: 0.5rem;
            font-size: 0.82rem;
            color: var(--text-secondary);
        }

        /* Blog list */
        .blog-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--border);
        }

        .blog-item-title {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .blog-item-meta {
            font-size: 0.72rem;
            color: var(--text-muted);
        }

        /* Login */
        .login-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }

        .login-box {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            max-width: 340px;
            width: 100%;
        }

        .login-box h2 {
            margin-bottom: 1rem;
        }

        .login-box input {
            width: 100%;
            padding: 0.6rem 1rem;
            margin-bottom: 0.75rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .login-box button {
            width: 100%;
            padding: 0.6rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
        }

        .schedule-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
            font-size: 0.85rem;
        }

        .badge {
            display: inline-block;
            padding: 0.1rem 0.4rem;
            border-radius: 999px;
            font-size: 0.68rem;
            font-weight: 600;
        }

        .badge-active {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge-cron {
            background: var(--accent-glow);
            color: var(--accent);
            border: 1px solid var(--accent);
        }

        @media (max-width: 600px) {
            .admin-wrap {
                padding: 0.75rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Live progress log */
        .progress-panel {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: var(--radius);
            padding: 0.75rem;
            max-height: 350px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.72rem;
            line-height: 1.6;
        }

        .progress-panel::-webkit-scrollbar {
            width: 6px;
        }

        .progress-panel::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 3px;
        }

        .log-entry {
            padding: 0.1rem 0;
            border-bottom: 1px solid rgba(48, 54, 61, 0.3);
        }

        .log-time {
            color: #6e7681;
            margin-right: 0.4rem;
        }

        .log-type {
            display: inline-block;
            padding: 0 0.3rem;
            border-radius: 3px;
            font-size: 0.65rem;
            font-weight: 700;
            margin-right: 0.3rem;
        }

        .log-start {
            background: #1f6feb33;
            color: #58a6ff;
        }

        .log-search {
            background: #1f6feb22;
            color: #79c0ff;
        }

        .log-parse {
            background: #8b949e22;
            color: #8b949e;
        }

        .log-extract {
            background: #3fb95022;
            color: #3fb950;
        }

        .log-save {
            background: #3fb95033;
            color: #56d364;
        }

        .log-warn {
            background: #d2992233;
            color: #e3b341;
        }

        .log-error {
            background: #f8514933;
            color: #f85149;
        }

        .log-done {
            background: #3fb95044;
            color: #56d364;
            font-weight: 700;
        }

        .log-msg {
            color: #c9d1d9;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .progress-header h3 {
            margin-bottom: 0;
        }

        .blinking-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #3fb950;
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }
    </style>
</head>

<body>
    <!-- Login -->
    <div class="login-overlay" id="login-overlay">
        <div class="login-box">
            <h2>üîê Admin Login</h2>
            <input type="password" id="admin-key-input" placeholder="Enter Admin Key" autofocus>
            <button onclick="doLogin()">Login</button>
            <div id="login-error" style="color:var(--danger);font-size:0.8rem;margin-top:0.5rem"></div>
        </div>
    </div>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <a href="/" class="logo-link">
                    <span class="logo-icon">üñ®Ô∏è</span>
                    <div>
                        <h1>3D Printer Prices</h1>
                        <p class="tagline">Admin Dashboard</p>
                    </div>
                </a>
            </div>
            <nav class="header-actions">
                <a href="/" class="nav-link">‚Üê Back to Site</a>
            </nav>
        </div>
    </header>

    <main class="admin-wrap">
        <h2 class="admin-title">‚öôÔ∏è Admin Dashboard</h2>

        <!-- Tabs -->
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="scraper">üîÑ Scraper</button>
            <button class="admin-tab" data-tab="products">üì¶ Products</button>
            <button class="admin-tab" data-tab="blog">üìù Blog</button>
            <button class="admin-tab" data-tab="schedule">‚è∞ Schedule</button>
            <button class="admin-tab" data-tab="settings">‚öôÔ∏è Settings</button>
        </div>

        <!-- ==================== SCRAPER TAB ==================== -->
        <div class="tab-content active" id="tab-scraper">
            <div class="admin-card">
                <h3>üìä Last Scrape Status</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Last Run</span>
                        <span class="info-value" id="last-run">Loading...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Status</span>
                        <span class="info-value" id="last-status">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Found</span>
                        <span class="info-value" id="last-found">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Saved</span>
                        <span class="info-value" id="last-saved">‚Äî</span>
                    </div>
                </div>

                <hr style="border-color:var(--border);margin:1rem 0">

                <h3 style="margin-top:0">üè∑Ô∏è Select Categories to Scrape</h3>
                <div style="display:flex;flex-wrap:wrap;gap:0.6rem;margin-bottom:0.75rem" id="scrape-cats">
                    <label style="display:flex;align-items:center;gap:0.3rem;font-size:0.82rem;cursor:pointer">
                        <input type="checkbox" value="all" id="cat-all" checked onchange="toggleAllCats(this)">
                        <strong>Select All</strong>
                    </label>
                    <label style="display:flex;align-items:center;gap:0.3rem;font-size:0.82rem;cursor:pointer">
                        <input type="checkbox" class="cat-box" value="3d_printer" checked> üñ®Ô∏è 3D Printers
                    </label>
                    <label style="display:flex;align-items:center;gap:0.3rem;font-size:0.82rem;cursor:pointer">
                        <input type="checkbox" class="cat-box" value="filament" checked> üßµ Filament
                    </label>
                    <label style="display:flex;align-items:center;gap:0.3rem;font-size:0.82rem;cursor:pointer">
                        <input type="checkbox" class="cat-box" value="resin" checked> üß™ Resin
                    </label>
                    <label style="display:flex;align-items:center;gap:0.3rem;font-size:0.82rem;cursor:pointer">
                        <input type="checkbox" class="cat-box" value="accessories" checked> üîß Accessories
                    </label>
                    <label style="display:flex;align-items:center;gap:0.3rem;font-size:0.82rem;cursor:pointer">
                        <input type="checkbox" class="cat-box" value="3d_pen" checked> üñäÔ∏è 3D Pen
                    </label>
                </div>

                <p style="font-size:0.72rem;color:var(--text-muted);margin-bottom:0.3rem">
                    üîó Affiliate Tag: <code>kiti09-20</code> ‚Äî All links auto-converted ¬∑
                    üõ°Ô∏è Dedup: <span class="badge badge-active">ASIN Upsert</span> (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥)
                </p>
                <div
                    style="background:var(--bg-primary);border:1px solid var(--border);border-radius:var(--radius-sm);padding:0.5rem 0.6rem;margin-bottom:0.75rem;font-size:0.72rem;display:flex;align-items:center;gap:0.4rem">
                    <span id="scraper-mode" style="color:var(--warning)">Loading...</span>
                    <span style="color:var(--text-muted)">¬∑ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API Key ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö <a href="#"
                            onclick="document.querySelector('[data-tab=settings]').click()"
                            style="color:var(--primary)">‚öôÔ∏è Settings</a></span>
                </div>

                <div class="form-row" style="margin-bottom:0.75rem">
                    <div class="form-group" style="margin-bottom:0">
                        <label>Max Products per Query</label>
                        <select class="form-select" id="scrape-limit">
                            <option value="10">10 products</option>
                            <option value="20">20 products</option>
                            <option value="30" selected>30 products (default)</option>
                            <option value="50">50 products</option>
                            <option value="100">100 products (max)</option>
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom:0">
                        <label style="visibility:hidden">.</label>
                        <p style="font-size:0.72rem;color:var(--text-muted);margin-top:0.3rem">
                            üìä 13 queries √ó <span id="limit-preview">30</span> = up to <strong
                                id="limit-total">390</strong> products
                        </p>
                    </div>
                </div>

                <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
                    <button class="btn btn-primary" id="btn-scrape" onclick="runScrape()">
                        üîÑ Scrape New Products
                    </button>
                    <button class="btn btn-warning" id="btn-update" onclick="updatePrices()">
                        üí∞ Update Prices
                    </button>
                </div>
                <div id="status-msg"></div>
                <div id="update-msg" style="margin-top:0.3rem;font-size:0.82rem"></div>
            </div>

            <!-- LIVE PROGRESS PANEL -->
            <div class="admin-card" id="progress-card" style="display:none">
                <div class="progress-header">
                    <h3>üì∫ Live Progress</h3>
                    <div>
                        <span class="blinking-dot" id="progress-dot"></span>
                        <span style="font-size:0.72rem;color:var(--text-muted);margin-left:0.3rem" id="progress-count">0
                            steps</span>
                    </div>
                </div>
                <div class="progress-panel" id="progress-log">
                    <div style="color:#6e7681">Waiting for scraper to start...</div>
                </div>
            </div>

            <div class="admin-card">
                <h3>üìã Scrape History</h3>
                <div style="overflow-x:auto">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Found</th>
                                <th>Saved</th>
                                <th>Errors</th>
                            </tr>
                        </thead>
                        <tbody id="log-body">
                            <tr>
                                <td colspan="5" style="text-align:center;color:var(--text-muted)">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==================== PRODUCTS TAB ==================== -->
        <div class="tab-content" id="tab-products">
            <div class="admin-card">
                <h3>üì¶ Product Overview</h3>
                <div class="info-grid" id="product-stats">
                    <div class="info-item">
                        <span class="info-label">Total Products</span>
                        <span class="info-value" id="p-total">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Categories</span>
                        <span class="info-value" id="p-categories">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Brands</span>
                        <span class="info-value" id="p-brands">‚Äî</span>
                    </div>
                </div>
            </div>

            <!-- ADD PRODUCT FORM -->
            <div class="admin-card">
                <h3>‚ûï Add Product Manually</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Product Name *</label>
                        <input type="text" class="form-input" id="add-name" placeholder="e.g. Bambu Lab P1S">
                    </div>
                    <div class="form-group">
                        <label>Price (USD) *</label>
                        <input type="number" class="form-input" id="add-price" placeholder="e.g. 599.00" step="0.01">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Brand</label>
                        <input type="text" class="form-input" id="add-brand" placeholder="e.g. Bambu Lab">
                    </div>
                    <div class="form-group">
                        <label>Category *</label>
                        <select class="form-select" id="add-category">
                            <option value="3d_printer">üñ®Ô∏è 3D Printer</option>
                            <option value="filament">üßµ Filament</option>
                            <option value="resin">üß™ Resin</option>
                            <option value="accessories">üîß Accessories</option>
                            <option value="3d_pen">üñäÔ∏è 3D Pen</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Product Type</label>
                        <select class="form-select" id="add-type">
                            <option value="fdm">FDM</option>
                            <option value="resin_sla">Resin / SLA</option>
                            <option value="pla">PLA</option>
                            <option value="abs">ABS</option>
                            <option value="petg">PETG</option>
                            <option value="tpu">TPU</option>
                            <option value="uv_resin">UV Resin</option>
                            <option value="nozzle">Nozzle</option>
                            <option value="build_plate">Build Plate</option>
                            <option value="tools">Tools</option>
                            <option value="3d_pen">3D Pen</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Condition</label>
                        <select class="form-select" id="add-condition">
                            <option value="new">New</option>
                            <option value="used">Used</option>
                            <option value="refurbished">Refurbished</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Amazon / Product URL (optional)</label>
                    <input type="url" class="form-input" id="add-url" placeholder="https://amazon.com/dp/...">
                </div>
                <button class="btn btn-success" id="btn-add-product" onclick="addProduct()">
                    ‚ûï Add Product
                </button>
                <div id="add-product-msg" style="margin-top:0.5rem;font-size:0.82rem"></div>
            </div>

            <div class="admin-card">
                <div
                    style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:0.5rem;margin-bottom:0.75rem">
                    <h3 style="margin:0">üì¶ Product Management</h3>
                    <span style="font-size:0.75rem;color:var(--text-muted)" id="pm-count">‚Äî products</span>
                </div>

                <!-- Search & Filter Bar -->
                <div style="display:flex;gap:0.4rem;margin-bottom:0.6rem;flex-wrap:wrap">
                    <input type="text" class="form-input" id="pm-search" placeholder="üîç Search product name..."
                        style="flex:1;min-width:180px;font-size:0.78rem;padding:0.35rem 0.6rem"
                        oninput="pmDebounceSearch()">
                    <select class="form-select" id="pm-cat" style="font-size:0.78rem;padding:0.35rem 0.5rem;width:auto"
                        onchange="pmLoadProducts(1)">
                        <option value="">All Categories</option>
                        <option value="3d_printer">üñ®Ô∏è 3D Printer</option>
                        <option value="filament">üßµ Filament</option>
                        <option value="resin">üß™ Resin</option>
                        <option value="accessories">üîß Accessories</option>
                        <option value="3d_pen">üñäÔ∏è 3D Pen</option>
                    </select>
                    <button class="btn btn-danger" id="pm-bulk-delete"
                        style="font-size:0.72rem;padding:0.35rem 0.6rem;display:none" onclick="pmBulkDelete()">
                        üóëÔ∏è Delete Selected (<span id="pm-sel-count">0</span>)
                    </button>
                </div>

                <!-- Product Table -->
                <div style="overflow-x:auto">
                    <table class="admin-table" style="font-size:0.75rem">
                        <thead>
                            <tr>
                                <th style="width:30px"><input type="checkbox" id="pm-select-all"
                                        onchange="pmToggleAll()"></th>
                                <th style="cursor:pointer" onclick="pmSort('product_name')">Product ‚Üï</th>
                                <th>Brand</th>
                                <th style="cursor:pointer" onclick="pmSort('price')">Price ‚Üï</th>
                                <th>Category</th>
                                <th>Rating</th>
                                <th style="cursor:pointer" onclick="pmSort('created_at')">Added ‚Üï</th>
                                <th style="width:70px">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="pm-body">
                            <tr>
                                <td colspan="8" style="text-align:center;color:var(--text-muted)">Loading...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div
                    style="display:flex;justify-content:space-between;align-items:center;margin-top:0.5rem;font-size:0.75rem">
                    <div>
                        <button class="btn" style="font-size:0.72rem;padding:0.25rem 0.5rem" id="pm-prev"
                            onclick="pmLoadProducts(pmPage-1)">‚Üê Prev</button>
                        <span id="pm-page-info" style="margin:0 0.5rem;color:var(--text-muted)">Page 1</span>
                        <button class="btn" style="font-size:0.72rem;padding:0.25rem 0.5rem" id="pm-next"
                            onclick="pmLoadProducts(pmPage+1)">Next ‚Üí</button>
                    </div>
                    <select class="form-select" style="font-size:0.72rem;padding:0.2rem 0.35rem;width:auto"
                        id="pm-limit" onchange="pmLoadProducts(1)">
                        <option value="20">20 per page</option>
                        <option value="50">50 per page</option>
                        <option value="100">100 per page</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- ==================== BLOG TAB ==================== -->
        <div class="tab-content" id="tab-blog">
            <div class="admin-card">
                <h3>üìù Existing Blog Posts</h3>
                <div id="blog-list">
                    <div class="blog-item">
                        <div>
                            <div class="blog-item-title">üèÜ Best 3D Printers Under $300 in 2026</div>
                            <div class="blog-item-meta">üìÖ Feb 21, 2026 ¬∑ Buying Guide</div>
                        </div>
                        <a href="/blog/best-3d-printers-under-300.html" target="_blank" class="btn btn-primary"
                            style="padding:0.3rem 0.6rem;font-size:0.75rem">View</a>
                    </div>
                </div>
            </div>

            <div class="admin-card">
                <h3>‚úçÔ∏è Generate New Blog Post</h3>
                <div class="form-group">
                    <label>Blog Topic</label>
                    <select class="form-select" id="blog-topic">
                        <option value="">‚Äî Select a topic ‚Äî</option>
                        <option value="best-resin-printers">Best Resin 3D Printers 2026</option>
                        <option value="fdm-vs-resin">FDM vs Resin: Which Should You Buy?</option>
                        <option value="best-filament">Best 3D Printer Filament Guide</option>
                        <option value="beginner-guide">Complete Beginner's Guide to 3D Printing</option>
                        <option value="accessories-must-have">Must-Have 3D Printer Accessories</option>
                        <option value="custom">Custom Topic...</option>
                    </select>
                </div>
                <div class="form-group" id="custom-topic-group" style="display:none">
                    <label>Custom Topic</label>
                    <input type="text" class="form-input" id="custom-topic"
                        placeholder="e.g. Best 3D Printers for Cosplay">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Article Type</label>
                        <select class="form-select" id="blog-type">
                            <option value="buying-guide">Buying Guide</option>
                            <option value="comparison">Comparison</option>
                            <option value="tutorial">Tutorial / How-To</option>
                            <option value="review">Review</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Target Length</label>
                        <select class="form-select" id="blog-length">
                            <option value="medium">Medium (~1,500 words)</option>
                            <option value="long">Long (~3,000 words)</option>
                            <option value="short">Short (~800 words)</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Additional Instructions (optional)</label>
                        <textarea class="form-textarea" id="blog-instructions"
                            placeholder="e.g. Focus on printers under $200, include comparison table, mention specific brands..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>AI Provider</label>
                        <select class="form-select" id="blog-ai-provider">
                            <option value="auto">üîÑ Auto (Gemini ‚Üí OpenAI fallback)</option>
                            <option value="gemini">ü§ñ Gemini</option>
                            <option value="openai">üß† OpenAI (GPT-4o-mini)</option>
                        </select>
                    </div>
                </div>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
                    <button class="btn btn-success" id="btn-blog" onclick="generateBlog(false)">
                        ‚úçÔ∏è Generate Blog Post
                    </button>
                    <button class="btn btn-primary" id="btn-auto-blog" onclick="generateBlog(true)">
                        ü§ñ AI Auto (Topic + Write)
                    </button>
                </div>
                <div id="blog-status" style="margin-top:0.5rem;font-size:0.78rem"></div>

                <!-- Blog Preview -->
                <div id="blog-preview-area" style="display:none;margin-top:0.75rem">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.3rem">
                        <strong style="font-size:0.82rem">üìÑ Generated Article</strong>
                        <div style="display:flex;gap:0.3rem;align-items:center">
                            <span id="blog-word-count" style="font-size:0.68rem;color:var(--text-muted)"></span>
                            <button class="btn" style="font-size:0.65rem;padding:0.2rem 0.4rem"
                                onclick="copyBlogContent()">üìã Copy</button>
                        </div>
                    </div>
                    <div id="blog-preview"
                        style="background:var(--bg-primary);border:1px solid var(--border);border-radius:var(--radius-sm);padding:0.75rem;max-height:400px;overflow-y:auto;font-size:0.78rem;line-height:1.6;white-space:pre-wrap">
                    </div>
                    <div style="display:flex;gap:0.4rem;margin-top:0.5rem;flex-wrap:wrap">
                        <button class="btn btn-success" onclick="publishBlog(true)">
                            üöÄ Publish to Website
                        </button>
                        <button class="btn" onclick="publishBlog(false)">
                            üíæ Save as Draft
                        </button>
                    </div>
                    <div id="publish-status" style="margin-top:0.3rem;font-size:0.72rem"></div>
                </div>
            </div>

            <!-- Published Posts Management -->
            <div class="admin-card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem">
                    <h3 style="margin:0">üìö Blog Posts</h3>
                    <button class="btn" style="font-size:0.65rem;padding:0.2rem 0.5rem" onclick="loadBlogPosts()">üîÑ
                        Refresh</button>
                </div>
                <div id="blog-posts-list" style="font-size:0.75rem;color:var(--text-muted)">Loading...</div>
            </div>

            <!-- X Post Generator -->
            <div class="admin-card">
                <h3>üê¶ Generate X Post</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Post Type</label>
                        <select class="form-select" id="x-gen-type">
                            <option value="new_products">üÜï New Products</option>
                            <option value="blog_links">üìù Blog / Guide Link</option>
                            <option value="deals">üí∞ Deals & Price Drops</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Custom Instructions (optional)</label>
                        <input type="text" class="form-input" id="x-custom-prompt"
                            placeholder="e.g. Focus on Creality K1C...">
                    </div>
                    <div class="form-group">
                        <label>AI Provider</label>
                        <select class="form-select" id="x-ai-provider">
                            <option value="auto">üîÑ Auto</option>
                            <option value="gemini">ü§ñ Gemini</option>
                            <option value="openai">üß† OpenAI</option>
                        </select>
                    </div>
                </div>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
                    <button class="btn btn-primary" id="btn-gen-x" onclick="generateXPost()">
                        ü§ñ Generate Tweet
                    </button>
                </div>
                <div id="x-gen-status" style="margin-top:0.3rem;font-size:0.72rem"></div>

                <!-- X Post Preview -->
                <div id="x-preview-area" style="display:none;margin-top:0.5rem">
                    <div
                        style="background:var(--bg-primary);border:1px solid var(--border);border-radius:var(--radius-sm);padding:0.6rem">
                        <div id="x-preview-text" style="font-size:0.82rem;line-height:1.5;margin-bottom:0.4rem"></div>
                        <div style="display:flex;justify-content:space-between;align-items:center">
                            <span id="x-char-count" style="font-size:0.65rem;color:var(--text-muted)"></span>
                            <div style="display:flex;gap:0.3rem">
                                <button class="btn" style="font-size:0.65rem;padding:0.2rem 0.4rem"
                                    onclick="copyXPost()">üìã Copy</button>
                                <button class="btn btn-primary" style="font-size:0.65rem;padding:0.2rem 0.4rem"
                                    onclick="generateXPost()">üîÑ Regenerate</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== SCHEDULE TAB ==================== -->
        <div class="tab-content" id="tab-schedule">
            <div class="admin-card">
                <h3>‚è∞ Scraper Schedule</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Current Schedule</span>
                        <span class="info-value" id="sch-current">Daily 6 AM UTC</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Last Run</span>
                        <span class="info-value" id="sch-last">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Next Run</span>
                        <span class="info-value" id="sch-next">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Status</span>
                        <span class="info-value"><span class="badge badge-active">Active</span></span>
                    </div>
                </div>

                <hr style="border-color:var(--border);margin:1rem 0">

                <h3 style="margin-top:0.5rem">üîÑ Change Schedule</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Frequency</label>
                        <select class="form-select" id="sch-freq">
                            <option value="0 6 * * *">Daily at 6:00 AM UTC</option>
                            <option value="0 */12 * * *">Every 12 Hours</option>
                            <option value="0 */6 * * *">Every 6 Hours</option>
                            <option value="0 */3 * * *">Every 3 Hours</option>
                            <option value="0 8 * * 1">Weekly (Monday 8 AM)</option>
                            <option value="custom">Custom Cron...</option>
                        </select>
                    </div>
                    <div class="form-group" id="custom-cron-group" style="display:none">
                        <label>Custom Cron Expression</label>
                        <input type="text" class="form-input" id="sch-custom-cron" placeholder="e.g. 0 */4 * * *">
                    </div>
                </div>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
                    <button class="btn btn-primary" onclick="saveSchedule()">
                        üíæ Save Schedule
                    </button>
                    <button class="btn btn-warning" onclick="runScheduledScrape()">
                        ‚ñ∂Ô∏è Run Now
                    </button>
                </div>
                <div id="sch-msg" style="margin-top:0.5rem;font-size:0.82rem"></div>

                <p style="margin-top:1rem;font-size:0.78rem;color:var(--text-muted)">
                    üí° Schedule changes update <code>vercel.json</code> locally. Redeploy to apply on Vercel.
                    "Run Now" triggers the scraper immediately regardless of schedule.
                </p>
            </div>

            <div class="admin-card">
                <h3>üìä Cron Schedule Reference</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Schedule</th>
                            <th>Cron Expression</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Every day 6 AM</td>
                            <td><code>0 6 * * *</code></td>
                            <td>Default</td>
                        </tr>
                        <tr>
                            <td>Every 12 hours</td>
                            <td><code>0 */12 * * *</code></td>
                            <td>Twice daily</td>
                        </tr>
                        <tr>
                            <td>Every 6 hours</td>
                            <td><code>0 */6 * * *</code></td>
                            <td>4x daily</td>
                        </tr>
                        <tr>
                            <td>Every 3 hours</td>
                            <td><code>0 */3 * * *</code></td>
                            <td>8x daily</td>
                        </tr>
                        <tr>
                            <td>Weekly (Mon 8 AM)</td>
                            <td><code>0 8 * * 1</code></td>
                            <td>Low frequency</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Blog Auto-Generation Schedule -->
            <div class="admin-card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem">
                    <h3 style="margin:0">üìù Blog Auto-Generation</h3>
                    <span id="blog-sch-status" class="badge" style="font-size:0.68rem">‚Äî</span>
                </div>
                <div class="info-grid" style="margin-bottom:0.5rem">
                    <div class="info-item">
                        <span class="info-label">AI Provider</span>
                        <span class="info-value" id="blog-ai-status">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Schedule</span>
                        <span class="info-value" id="blog-sch-cron">Not set</span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Frequency</label>
                        <select class="form-select" id="blog-freq">
                            <option value="0 8 * * 1">Weekly (Mon 8 AM)</option>
                            <option value="0 8 */3 * *">Every 3 Days</option>
                            <option value="0 8 * * *">Daily</option>
                            <option value="custom">Custom Cron...</option>
                        </select>
                    </div>
                    <div class="form-group" id="blog-custom-cron-group" style="display:none">
                        <label>Custom Cron</label>
                        <input type="text" class="form-input" id="blog-custom-cron" placeholder="e.g. 0 9 * * 2,5">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="blog-sch-enabled" style="margin-right:0.3rem">
                            Enable Auto Blog
                        </label>
                    </div>
                </div>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
                    <button class="btn btn-primary" onclick="saveBlogSchedule()">üíæ Save Blog Schedule</button>
                    <button class="btn btn-warning" onclick="document.querySelector('[data-tab=blog]').click()">‚úçÔ∏è Write
                        Now</button>
                </div>
                <div id="blog-sch-msg" style="margin-top:0.3rem;font-size:0.72rem"></div>
                <p style="font-size:0.68rem;color:var(--text-muted);margin-top:0.5rem;margin-bottom:0">
                    ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á Gemini API Key ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö <a href="#"
                        onclick="document.querySelector('[data-tab=settings]').click()"
                        style="color:var(--primary)">Settings</a>
                </p>
            </div>

            <!-- X Auto-Post Schedule -->
            <div class="admin-card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem">
                    <h3 style="margin:0">üê¶ X Auto-Post</h3>
                    <span id="x-sch-status" class="badge" style="font-size:0.68rem">‚Äî</span>
                </div>
                <div class="info-grid" style="margin-bottom:0.5rem">
                    <div class="info-item">
                        <span class="info-label">X API Status</span>
                        <span class="info-value" id="x-api-status">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Schedule</span>
                        <span class="info-value" id="x-sch-cron">Not set</span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Frequency</label>
                        <select class="form-select" id="x-freq">
                            <option value="0 9 * * *">Daily at 9 AM</option>
                            <option value="0 */12 * * *">Every 12 Hours</option>
                            <option value="0 9,18 * * *">Twice Daily (9 AM, 6 PM)</option>
                            <option value="custom">Custom Cron...</option>
                        </select>
                    </div>
                    <div class="form-group" id="x-custom-cron-group" style="display:none">
                        <label>Custom Cron</label>
                        <input type="text" class="form-input" id="x-custom-cron" placeholder="e.g. 0 */8 * * *">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Post Type</label>
                        <select class="form-select" id="x-post-type">
                            <option value="new_products">üÜï New Products</option>
                            <option value="blog_links">üìù Blog Links</option>
                            <option value="deals">üí∞ Price Drops / Deals</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="x-sch-enabled" style="margin-right:0.3rem">
                            Enable Auto-Post
                        </label>
                    </div>
                </div>
                <div style="display:flex;gap:0.5rem;flex-wrap:wrap">
                    <button class="btn btn-primary" onclick="saveXSchedule()">üíæ Save X Schedule</button>
                    <button class="btn btn-warning" onclick="postToXNow()" id="btn-x-post">üê¶ Post Now</button>
                </div>
                <div id="x-sch-msg" style="margin-top:0.3rem;font-size:0.72rem"></div>
                <p style="font-size:0.68rem;color:var(--text-muted);margin-top:0.5rem;margin-bottom:0">
                    ‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á X API Keys ‡∏ó‡∏±‡πâ‡∏á 4 ‡∏ï‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö <a href="#"
                        onclick="document.querySelector('[data-tab=settings]').click()"
                        style="color:var(--primary)">Settings</a>
                </p>
            </div>
        </div>

        <!-- ==================== SETTINGS TAB ==================== -->
        <div class="tab-content" id="tab-settings">
            <div class="admin-card">
                <h3>üîë API Keys</h3>
                <p style="font-size:0.75rem;color:var(--text-muted);margin-bottom:1rem">
                    ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API keys ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‚Äî ‡∏Å‡∏£‡∏≠‡∏Å Key ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Save & Test ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                </p>

                <!-- ScraperAPI -->
                <div class="api-key-row"
                    style="background:var(--bg-primary);border:1px solid var(--border);border-radius:var(--radius-sm);padding:0.6rem;margin-bottom:0.5rem">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.3rem">
                        <strong style="font-size:0.78rem">üîë ScraperAPI</strong>
                        <span class="key-status" id="ks-scraper_api_key" style="font-size:0.68rem">‚Äî</span>
                    </div>
                    <div style="display:flex;gap:0.3rem">
                        <input type="text" class="form-input api-key-input" data-key="scraper_api_key"
                            placeholder="Paste ScraperAPI key..."
                            style="flex:1;font-size:0.75rem;font-family:monospace;padding:0.3rem 0.5rem">
                        <button class="btn btn-primary"
                            style="font-size:0.68rem;padding:0.3rem 0.5rem;white-space:nowrap"
                            onclick="saveApiKey('scraper_api_key', this)">üíæ Save & Test</button>
                    </div>
                    <div class="key-msg" id="msg-scraper_api_key" style="font-size:0.68rem;margin-top:0.2rem"></div>
                    <div style="font-size:0.65rem;color:var(--text-muted);margin-top:0.15rem">
                        ‡∏î‡∏∂‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å Amazon ¬∑ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ü‡∏£‡∏µ‡∏ó‡∏µ‡πà <a href="https://www.scraperapi.com/signup" target="_blank"
                            style="color:var(--primary)">scraperapi.com</a> (5,000 free/mo)
                    </div>
                </div>

                <!-- Gemini API -->
                <div class="api-key-row"
                    style="background:var(--bg-primary);border:1px solid var(--border);border-radius:var(--radius-sm);padding:0.6rem;margin-bottom:0.5rem">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.3rem">
                        <strong style="font-size:0.78rem">ü§ñ Gemini API</strong>
                        <span class="key-status" id="ks-gemini_api_key" style="font-size:0.68rem">‚Äî</span>
                    </div>
                    <div style="display:flex;gap:0.3rem">
                        <input type="text" class="form-input api-key-input" data-key="gemini_api_key"
                            placeholder="Paste Gemini API key..."
                            style="flex:1;font-size:0.75rem;font-family:monospace;padding:0.3rem 0.5rem">
                        <button class="btn btn-primary"
                            style="font-size:0.68rem;padding:0.3rem 0.5rem;white-space:nowrap"
                            onclick="saveApiKey('gemini_api_key', this)">üíæ Save & Test</button>
                    </div>
                    <div class="key-msg" id="msg-gemini_api_key" style="font-size:0.68rem;margin-top:0.2rem"></div>
                    <div style="font-size:0.65rem;color:var(--text-muted);margin-top:0.15rem">
                        ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô Blog ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ¬∑ ‡∏™‡∏£‡πâ‡∏≤‡∏á key ‡∏ó‡∏µ‡πà <a href="https://aistudio.google.com/apikey"
                            target="_blank" style="color:var(--primary)">aistudio.google.com</a> (‡∏ü‡∏£‡∏µ)
                    </div>
                </div>

                <!-- OpenAI API -->
                <div class="api-key-row"
                    style="background:var(--bg-primary);border:1px solid var(--border);border-radius:var(--radius-sm);padding:0.6rem;margin-bottom:0.5rem">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.3rem">
                        <strong style="font-size:0.78rem">üß† OpenAI API</strong>
                        <span class="key-status" id="ks-openai_api_key" style="font-size:0.68rem">‚Äî</span>
                    </div>
                    <div style="display:flex;gap:0.3rem">
                        <input type="text" class="form-input api-key-input" data-key="openai_api_key"
                            placeholder="Paste OpenAI API key (sk-...)"
                            style="flex:1;font-size:0.75rem;font-family:monospace;padding:0.3rem 0.5rem">
                        <button class="btn btn-primary"
                            style="font-size:0.68rem;padding:0.3rem 0.5rem;white-space:nowrap"
                            onclick="saveApiKey('openai_api_key', this)">üíæ Save & Test</button>
                    </div>
                    <div class="key-msg" id="msg-openai_api_key" style="font-size:0.68rem;margin-top:0.2rem"></div>
                    <div style="font-size:0.65rem;color:var(--text-muted);margin-top:0.15rem">
                        ‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô Gemini ‡πÑ‡∏î‡πâ ¬∑ ‡∏™‡∏£‡πâ‡∏≤‡∏á key ‡∏ó‡∏µ‡πà <a href="https://platform.openai.com/api-keys" target="_blank"
                            style="color:var(--primary)">platform.openai.com</a> (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ credit)
                    </div>
                </div>

                <!-- X/Twitter API Keys -->
                <div
                    style="background:var(--bg-primary);border:1px solid var(--border);border-radius:var(--radius-sm);padding:0.6rem;margin-bottom:0.5rem">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem">
                        <strong style="font-size:0.78rem">üê¶ X (Twitter) API</strong>
                        <span class="key-status" id="ks-x_api_key" style="font-size:0.68rem">‚Äî</span>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.3rem;margin-bottom:0.3rem">
                        <div>
                            <label style="font-size:0.65rem;color:var(--text-muted)">API Key</label>
                            <input type="text" class="form-input api-key-input" data-key="x_api_key"
                                placeholder="API Key"
                                style="font-size:0.72rem;font-family:monospace;padding:0.25rem 0.4rem;width:100%">
                        </div>
                        <div>
                            <label style="font-size:0.65rem;color:var(--text-muted)">API Secret</label>
                            <input type="text" class="form-input api-key-input" data-key="x_api_secret"
                                placeholder="API Secret"
                                style="font-size:0.72rem;font-family:monospace;padding:0.25rem 0.4rem;width:100%">
                        </div>
                        <div>
                            <label style="font-size:0.65rem;color:var(--text-muted)">Access Token</label>
                            <input type="text" class="form-input api-key-input" data-key="x_access_token"
                                placeholder="Access Token"
                                style="font-size:0.72rem;font-family:monospace;padding:0.25rem 0.4rem;width:100%">
                        </div>
                        <div>
                            <label style="font-size:0.65rem;color:var(--text-muted)">Access Secret</label>
                            <input type="text" class="form-input api-key-input" data-key="x_access_secret"
                                placeholder="Access Secret"
                                style="font-size:0.72rem;font-family:monospace;padding:0.25rem 0.4rem;width:100%">
                        </div>
                    </div>
                    <button class="btn btn-primary" style="font-size:0.68rem;padding:0.3rem 0.5rem"
                        onclick="saveAllXKeys()">üíæ Save All X Keys</button>
                    <div class="key-msg" id="msg-x_api_key" style="font-size:0.68rem;margin-top:0.2rem"></div>
                    <div style="font-size:0.65rem;color:var(--text-muted);margin-top:0.15rem">
                        ‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏ô X ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ¬∑ ‡∏™‡∏£‡πâ‡∏≤‡∏á app ‡∏ó‡∏µ‡πà <a href="https://developer.x.com/en/portal/dashboard"
                            target="_blank" style="color:var(--primary)">developer.x.com</a>
                    </div>
                </div>
            </div>

            <div class="admin-card">
                <h3>üîó Quick Links</h3>
                <div style="display:flex;flex-wrap:wrap;gap:0.5rem;margin-top:0.5rem">
                    <a href="https://vercel.com/dashboard" target="_blank" class="btn btn-primary"
                        style="font-size:0.75rem">Vercel Dashboard</a>
                    <a href="https://supabase.com/dashboard" target="_blank" class="btn btn-success"
                        style="font-size:0.75rem">Supabase Dashboard</a>
                    <a href="https://search.google.com/search-console" target="_blank" class="btn btn-warning"
                        style="font-size:0.75rem">Search Console</a>
                    <a href="https://www.google.com/adsense" target="_blank" class="btn"
                        style="font-size:0.75rem;background:var(--bg-hover);color:var(--text-primary)">AdSense</a>
                </div>
            </div>
        </div>
    </main>

    <script>
        let adminKey = '';

        // ===== Login =====
        function doLogin() {
            adminKey = document.getElementById('admin-key-input').value;
            if (!adminKey) {
                document.getElementById('login-error').textContent = 'Please enter admin key';
                return;
            }
            document.getElementById('login-overlay').style.display = 'none';
            init();
        }
        document.getElementById('admin-key-input').addEventListener('keydown', e => {
            if (e.key === 'Enter') doLogin();
        });

        // ===== Tabs =====
        document.querySelectorAll('.admin-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
                // Auto-load products when switching to products tab
                if (tab.dataset.tab === 'products') pmLoadProducts(pmPage);
            });
        });

        // ===== Blog topic toggle =====
        document.getElementById('blog-topic').addEventListener('change', (e) => {
            document.getElementById('custom-topic-group').style.display =
                e.target.value === 'custom' ? 'block' : 'none';
        });

        // ===== Schedule freq toggle =====
        document.getElementById('sch-freq').addEventListener('change', (e) => {
            document.getElementById('custom-cron-group').style.display =
                e.target.value === 'custom' ? 'block' : 'none';
        });

        // Blog freq toggle
        document.getElementById('blog-freq').addEventListener('change', (e) => {
            document.getElementById('blog-custom-cron-group').style.display =
                e.target.value === 'custom' ? 'block' : 'none';
        });

        // X freq toggle
        document.getElementById('x-freq').addEventListener('change', (e) => {
            document.getElementById('x-custom-cron-group').style.display =
                e.target.value === 'custom' ? 'block' : 'none';
        });

        // ===== Init =====
        function init() {
            loadStatus();
            loadHistory();
            loadProductStats();
            loadSchedule();
            loadApiKeysStatus();
            loadBlogSchedule();
            loadXSchedule();
            loadBlogPosts();
            setInterval(checkRunning, 2000);
        }

        // ===== Unified API Key Management =====

        async function saveApiKey(keyType, btn) {
            const input = document.querySelector(`.api-key-input[data-key="${keyType}"]`);
            const value = input?.value.trim();
            const msg = document.getElementById(`msg-${keyType}`);

            if (!value) { msg.innerHTML = '<span style="color:var(--warning)">‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á Key ‡∏Å‡πà‡∏≠‡∏ô</span>'; return; }

            btn.disabled = true;
            const origText = btn.textContent;
            btn.textContent = '‚è≥ Testing...';
            msg.innerHTML = '<span style="color:var(--text-muted)">üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</span>';

            try {
                const res = await fetch('/api/admin/save-api-key', {
                    method: 'POST', headers: apiHeaders(),
                    body: JSON.stringify({ keyType, value }),
                });
                const d = await res.json();
                if (d.success) {
                    msg.innerHTML = `<span style="color:var(--success)">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß (${d.masked})</span>`;
                    input.value = '';
                    loadApiKeysStatus();
                } else {
                    msg.innerHTML = `<span style="color:var(--danger)">‚ùå ${d.error}</span>`;
                }
            } catch (e) {
                msg.innerHTML = `<span style="color:var(--danger)">‚ùå ${e.message}</span>`;
            } finally {
                btn.disabled = false;
                btn.textContent = origText;
            }
        }

        async function saveAllXKeys() {
            const keys = ['x_api_key', 'x_api_secret', 'x_access_token', 'x_access_secret'];
            const msg = document.getElementById('msg-x_api_key');
            let saved = 0, errors = [];

            for (const k of keys) {
                const input = document.querySelector(`.api-key-input[data-key="${k}"]`);
                const val = input?.value.trim();
                if (!val) continue;
                try {
                    const res = await fetch('/api/admin/save-api-key', {
                        method: 'POST', headers: apiHeaders(),
                        body: JSON.stringify({ keyType: k, value: val }),
                    });
                    const d = await res.json();
                    if (d.success) { saved++; input.value = ''; }
                    else errors.push(d.error);
                } catch (e) { errors.push(e.message); }
            }
            if (saved > 0) {
                msg.innerHTML = `<span style="color:var(--success)">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ${saved} keys ‡πÅ‡∏•‡πâ‡∏ß</span>`;
                loadApiKeysStatus();
            }
            if (errors.length) msg.innerHTML += `<br><span style="color:var(--danger)">‚ùå ${errors.join(', ')}</span>`;
        }

        async function loadApiKeysStatus() {
            try {
                const res = await fetch('/api/admin/api-keys-status', { headers: apiHeaders() });
                const keys = await res.json();

                // Update scraper mode in Scraper tab
                const scraperEl = document.getElementById('scraper-mode');
                if (keys.scraper_api_key?.configured) {
                    scraperEl.innerHTML = `‚úÖ Active <span style="font-family:monospace;opacity:0.7">(${keys.scraper_api_key.masked})</span>`;
                    scraperEl.style.color = 'var(--success)';
                } else {
                    scraperEl.textContent = '‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤';
                    scraperEl.style.color = 'var(--danger)';
                }

                // Update Settings tab key statuses
                const labels = {
                    scraper_api_key: 'üîë ScraperAPI',
                    gemini_api_key: 'ü§ñ Gemini',
                    x_api_key: 'üê¶ X API',
                };
                for (const [k, info] of Object.entries(keys)) {
                    const el = document.getElementById(`ks-${k}`);
                    if (!el) continue;
                    if (info.configured) {
                        el.innerHTML = `<span class="badge badge-active">‚úÖ Active</span> <span style="font-family:monospace;opacity:0.6;font-size:0.62rem">${info.masked}</span>`;
                    } else {
                        el.innerHTML = '<span class="badge" style="background:var(--danger);color:white">Not set</span>';
                    }
                    // Pre-fill input placeholder
                    const inp = document.querySelector(`.api-key-input[data-key="${k}"]`);
                    if (inp && info.configured) inp.placeholder = info.masked + ' (paste new to replace)';
                }

                // Update Blog AI status
                const blogAI = document.getElementById('blog-ai-status');
                if (blogAI) {
                    const hasGemini = keys.gemini_api_key?.configured;
                    const hasOpenAI = keys.openai_api_key?.configured;
                    if (hasGemini && hasOpenAI) {
                        blogAI.textContent = '‚úÖ Gemini + OpenAI';
                        blogAI.style.color = 'var(--success)';
                    } else if (hasGemini) {
                        blogAI.textContent = '‚úÖ Gemini Ready';
                        blogAI.style.color = 'var(--success)';
                    } else if (hasOpenAI) {
                        blogAI.textContent = '‚úÖ OpenAI Ready';
                        blogAI.style.color = 'var(--success)';
                    } else {
                        blogAI.textContent = '‚ùå ‡∏ï‡∏±‡πâ‡∏á Key ‡∏Å‡πà‡∏≠‡∏ô';
                        blogAI.style.color = 'var(--danger)';
                    }
                }

                // Update X API status
                const xAPI = document.getElementById('x-api-status');
                if (xAPI) {
                    const xKeys = ['x_api_key', 'x_api_secret', 'x_access_token', 'x_access_secret'];
                    const configured = xKeys.filter(k => keys[k]?.configured).length;
                    xAPI.textContent = configured === 4 ? '‚úÖ Ready (4/4)' : `‚ö†Ô∏è ${configured}/4 keys`;
                    xAPI.style.color = configured === 4 ? 'var(--success)' : 'var(--warning)';
                }
            } catch (e) { }
        }

        // ===== Blog Schedule =====
        async function loadBlogSchedule() {
            try {
                const res = await fetch('/api/admin/get-schedule/blog', { headers: apiHeaders() });
                const d = await res.json();
                const statusEl = document.getElementById('blog-sch-status');
                const cronEl = document.getElementById('blog-sch-cron');
                if (d.enabled) {
                    statusEl.textContent = 'üü¢ Enabled';
                    statusEl.className = 'badge badge-active';
                    cronEl.textContent = d.cron || 'Not set';
                } else {
                    statusEl.textContent = '‚è∏Ô∏è Disabled';
                    statusEl.className = 'badge';
                    cronEl.textContent = d.cron || 'Not set';
                }
                if (d.cron) {
                    const sel = document.getElementById('blog-freq');
                    const opts = [...sel.options].map(o => o.value);
                    if (opts.includes(d.cron)) sel.value = d.cron;
                    else { sel.value = 'custom'; document.getElementById('blog-custom-cron').value = d.cron; }
                }
                document.getElementById('blog-sch-enabled').checked = d.enabled;
            } catch (e) { }
        }

        async function saveBlogSchedule() {
            const freq = document.getElementById('blog-freq').value;
            const cron = freq === 'custom' ? document.getElementById('blog-custom-cron').value : freq;
            const enabled = document.getElementById('blog-sch-enabled').checked;
            const msg = document.getElementById('blog-sch-msg');
            try {
                const res = await fetch('/api/admin/save-schedule', {
                    method: 'POST', headers: apiHeaders(),
                    body: JSON.stringify({ scheduleType: 'blog_schedule', cron, enabled }),
                });
                const d = await res.json();
                if (d.success) {
                    msg.innerHTML = `<span style="color:var(--success)">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚Äî ${enabled ? 'Enabled' : 'Disabled'} (${cron})</span>`;
                    loadBlogSchedule();
                } else {
                    msg.innerHTML = `<span style="color:var(--danger)">‚ùå ${d.error}</span>`;
                }
            } catch (e) { msg.innerHTML = `<span style="color:var(--danger)">‚ùå ${e.message}</span>`; }
        }

        // ===== X Schedule =====
        async function loadXSchedule() {
            try {
                const res = await fetch('/api/admin/get-schedule/x', { headers: apiHeaders() });
                const d = await res.json();
                const statusEl = document.getElementById('x-sch-status');
                const cronEl = document.getElementById('x-sch-cron');
                if (d.enabled) {
                    statusEl.textContent = 'üü¢ Enabled';
                    statusEl.className = 'badge badge-active';
                } else {
                    statusEl.textContent = '‚è∏Ô∏è Disabled';
                    statusEl.className = 'badge';
                }
                cronEl.textContent = d.cron || 'Not set';
                if (d.cron) {
                    const sel = document.getElementById('x-freq');
                    const opts = [...sel.options].map(o => o.value);
                    if (opts.includes(d.cron)) sel.value = d.cron;
                    else { sel.value = 'custom'; document.getElementById('x-custom-cron').value = d.cron; }
                }
                document.getElementById('x-sch-enabled').checked = d.enabled;
            } catch (e) { }
        }

        async function saveXSchedule() {
            const freq = document.getElementById('x-freq').value;
            const cron = freq === 'custom' ? document.getElementById('x-custom-cron').value : freq;
            const enabled = document.getElementById('x-sch-enabled').checked;
            const msg = document.getElementById('x-sch-msg');
            try {
                const res = await fetch('/api/admin/save-schedule', {
                    method: 'POST', headers: apiHeaders(),
                    body: JSON.stringify({ scheduleType: 'x_schedule', cron, enabled }),
                });
                const d = await res.json();
                if (d.success) {
                    msg.innerHTML = `<span style="color:var(--success)">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚Äî ${enabled ? 'Enabled' : 'Disabled'} (${cron})</span>`;
                    loadXSchedule();
                } else {
                    msg.innerHTML = `<span style="color:var(--danger)">‚ùå ${d.error}</span>`;
                }
            } catch (e) { msg.innerHTML = `<span style="color:var(--danger)">‚ùå ${e.message}</span>`; }
        }

        function postToXNow() {
            document.getElementById('x-sch-msg').innerHTML = '<span style="color:var(--warning)">üöß X Auto-Post will be available soon ‚Äî ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á API Keys ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö</span>';
        }
        // ===== Product Management =====
        let pmPage = 1, pmTotalPages = 1, pmSortCol = 'created_at', pmSortOrder = 'desc';
        let pmSelected = new Set();
        let pmSearchTimer = null;

        function pmDebounceSearch() {
            clearTimeout(pmSearchTimer);
            pmSearchTimer = setTimeout(() => pmLoadProducts(1), 400);
        }

        function pmSort(col) {
            if (pmSortCol === col) {
                pmSortOrder = pmSortOrder === 'desc' ? 'asc' : 'desc';
            } else {
                pmSortCol = col;
                pmSortOrder = col === 'product_name' ? 'asc' : 'desc';
            }
            pmLoadProducts(pmPage);
        }

        async function pmLoadProducts(page = 1) {
            pmPage = page;
            pmSelected.clear();
            pmUpdateBulkBtn();
            const search = document.getElementById('pm-search').value.trim();
            const cat = document.getElementById('pm-cat').value;
            const limit = document.getElementById('pm-limit').value;
            const params = new URLSearchParams({ page, limit, sort: pmSortCol, order: pmSortOrder });
            if (search) params.set('search', search);
            if (cat) params.set('category', cat);

            try {
                const res = await fetch(`/api/admin/products?${params}`, { headers: apiHeaders() });
                const d = await res.json();
                if (d.error) throw new Error(d.error);

                pmTotalPages = d.totalPages || 1;
                document.getElementById('pm-count').textContent = `${d.total} products`;
                document.getElementById('pm-page-info').textContent = `Page ${d.page} / ${pmTotalPages}`;
                document.getElementById('pm-prev').disabled = d.page <= 1;
                document.getElementById('pm-next').disabled = d.page >= pmTotalPages;
                document.getElementById('pm-select-all').checked = false;

                const tbody = document.getElementById('pm-body');
                if (!d.products?.length) {
                    tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;color:var(--text-muted)">No products found</td></tr>';
                    return;
                }

                tbody.innerHTML = d.products.map(p => `
                    <tr data-id="${p.id}">
                        <td><input type="checkbox" class="pm-cb" value="${p.id}" onchange="pmUpdateBulkBtn()"></td>
                        <td style="max-width:280px">
                            <div style="font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="${(p.product_name || '').replace(/"/g, '&quot;')}">
                                ${p.amazon_url ? `<a href="${p.amazon_url}" target="_blank" style="color:var(--primary);text-decoration:none">${p.product_name || '‚Äî'}</a>` : (p.product_name || '‚Äî')}
                            </div>
                            <div style="font-size:0.65rem;color:var(--text-muted)">${p.amazon_asin || ''}</div>
                        </td>
                        <td>${p.brand || '‚Äî'}</td>
                        <td style="color:var(--primary);font-weight:600">$${Number(p.price).toFixed(2)}</td>
                        <td><span class="badge badge-active" style="font-size:0.65rem">${p.category || '‚Äî'}</span></td>
                        <td>${p.rating ? `‚≠ê ${p.rating}` : '‚Äî'}</td>
                        <td style="font-size:0.68rem;color:var(--text-muted)">${pmTimeAgo(p.created_at)}</td>
                        <td>
                            <button class="btn btn-danger" style="font-size:0.65rem;padding:0.15rem 0.4rem" onclick="pmDeleteProduct('${p.id}', this)">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                document.getElementById('pm-body').innerHTML = `<tr><td colspan="8" style="color:var(--danger)">${e.message}</td></tr>`;
            }
        }

        function pmToggleAll() {
            const checked = document.getElementById('pm-select-all').checked;
            document.querySelectorAll('.pm-cb').forEach(cb => { cb.checked = checked; });
            pmUpdateBulkBtn();
        }

        function pmUpdateBulkBtn() {
            const checks = document.querySelectorAll('.pm-cb:checked');
            pmSelected = new Set([...checks].map(c => c.value));
            const btn = document.getElementById('pm-bulk-delete');
            const cnt = document.getElementById('pm-sel-count');
            btn.style.display = pmSelected.size > 0 ? 'inline-flex' : 'none';
            cnt.textContent = pmSelected.size;
        }

        async function pmDeleteProduct(id, btn) {
            if (!confirm('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠?')) return;
            btn.disabled = true;
            btn.textContent = '...';
            try {
                await fetch(`/api/admin/products/${id}`, { method: 'DELETE', headers: apiHeaders() });
                btn.closest('tr').remove();
                // Update count
                const countEl = document.getElementById('pm-count');
                const current = parseInt(countEl.textContent) || 0;
                countEl.textContent = `${Math.max(0, current - 1)} products`;
            } catch (e) {
                alert('Delete failed: ' + e.message);
                btn.disabled = false;
                btn.textContent = 'üóëÔ∏è';
            }
        }

        async function pmBulkDelete() {
            const ids = [...pmSelected];
            if (!ids.length) return;
            if (!confirm(`‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${ids.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠?`)) return;
            const btn = document.getElementById('pm-bulk-delete');
            btn.disabled = true;
            try {
                await fetch('/api/admin/products/bulk-delete', {
                    method: 'POST',
                    headers: apiHeaders(),
                    body: JSON.stringify({ ids }),
                });
                pmLoadProducts(pmPage);
            } catch (e) {
                alert('Bulk delete failed: ' + e.message);
            }
            btn.disabled = false;
        }

        function pmTimeAgo(dateStr) {
            if (!dateStr) return '‚Äî';
            const diff = Date.now() - new Date(dateStr).getTime();
            const mins = Math.floor(diff / 60000);
            if (mins < 1) return 'Just now';
            if (mins < 60) return mins + 'm ago';
            const hrs = Math.floor(mins / 60);
            if (hrs < 24) return hrs + 'h ago';
            const days = Math.floor(hrs / 24);
            return days + 'd ago';
        }

        // ===== API helpers =====
        function apiHeaders() {
            return { 'X-Admin-Key': adminKey, 'Content-Type': 'application/json' };
        }

        // ===== Scraper =====
        async function loadStatus() {
            try {
                const res = await fetch('/api/scrape-status');
                const d = await res.json();
                if (d.lastScrape) {
                    document.getElementById('last-run').textContent = timeAgo(d.lastScrape);
                    document.getElementById('last-run').title = new Date(d.lastScrape).toLocaleString();
                    document.getElementById('last-status').innerHTML = `<span class="status-${d.status}">${d.status}</span>`;
                    document.getElementById('last-found').textContent = d.productsFound || '‚Äî';
                    document.getElementById('last-saved').textContent = d.productsSaved || '‚Äî';
                } else {
                    document.getElementById('last-run').textContent = 'Never';
                }
            } catch (e) {
                document.getElementById('last-run').textContent = 'Error';
            }
        }

        async function loadHistory() {
            try {
                const res = await fetch('/api/scrape-logs');
                const logs = await res.json();
                const tbody = document.getElementById('log-body');
                if (!logs?.length) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--text-muted)">No history</td></tr>';
                    return;
                }
                tbody.innerHTML = logs.map(l => `
                    <tr>
                        <td>${fmtDate(l.completed_at || l.created_at)}</td>
                        <td><span class="status-${l.status}">${l.status}</span></td>
                        <td>${l.products_found || 0}</td>
                        <td>${l.products_saved || 0}</td>
                        <td>${l.errors_count || 0}</td>
                    </tr>`).join('');
            } catch (e) { }
        }

        function toggleAllCats(el) {
            document.querySelectorAll('.cat-box').forEach(cb => cb.checked = el.checked);
        }
        document.querySelectorAll('.cat-box').forEach(cb => {
            cb.addEventListener('change', () => {
                const all = document.querySelectorAll('.cat-box');
                const checked = document.querySelectorAll('.cat-box:checked');
                document.getElementById('cat-all').checked = all.length === checked.length;
            });
        });

        // Limit preview
        document.getElementById('scrape-limit').addEventListener('change', (e) => {
            const v = parseInt(e.target.value);
            document.getElementById('limit-preview').textContent = v;
            const catCount = document.querySelectorAll('.cat-box:checked').length || 13;
            document.getElementById('limit-total').textContent = v * catCount;
        });

        async function runScrape() {
            // Gather selected categories
            const checked = Array.from(document.querySelectorAll('.cat-box:checked')).map(c => c.value);
            if (checked.length === 0) {
                document.getElementById('status-msg').textContent = '‚ö†Ô∏è Please select at least one category';
                return;
            }

            const allChecked = checked.length === document.querySelectorAll('.cat-box').length;
            const categories = allChecked ? null : checked; // null = all
            const maxPerQuery = parseInt(document.getElementById('scrape-limit').value) || 30;

            const btn = document.getElementById('btn-scrape');
            const msg = document.getElementById('status-msg');
            btn.disabled = true;
            btn.classList.add('running');
            btn.innerHTML = '‚è≥ Scraping...';
            const catLabel = allChecked ? 'all categories' : checked.join(', ');
            msg.textContent = `Scraping ${catLabel} (max ${maxPerQuery}/query) ‚Äî this may take 1-2 minutes...`;
            // Show progress panel
            document.getElementById('progress-card').style.display = '';
            document.getElementById('progress-log').innerHTML = '<div style="color:#6e7681">‚è≥ Connecting to scraper...</div>';
            lastProgressCount = 0;

            try {
                const res = await fetch('/api/admin/scrape', {
                    method: 'POST',
                    headers: apiHeaders(),
                    body: JSON.stringify({ categories, maxPerQuery }),
                });
                const d = await res.json();
                if (res.ok) {
                    msg.textContent = '‚úÖ ' + d.message + ' ‚Äî Watch progress below ‚¨áÔ∏è';
                } else {
                    msg.textContent = '‚ùå ' + d.error;
                    btn.disabled = false;
                    btn.classList.remove('running');
                    btn.innerHTML = 'üîÑ Scrape New Products';
                    document.getElementById('progress-card').style.display = 'none';
                }
            } catch (e) {
                msg.textContent = '‚ùå ' + e.message;
                btn.disabled = false;
                btn.classList.remove('running');
                btn.innerHTML = 'üîÑ Scrape New Products';
                document.getElementById('progress-card').style.display = 'none';
            }
        }

        let lastProgressCount = 0;

        function renderProgressLog(entries) {
            if (!entries?.length) return;
            const panel = document.getElementById('progress-log');
            const typeIcons = {
                start: 'üöÄ', search: 'üîç', parse: 'üìÑ', extract: 'üì¶',
                save: 'üíæ', warn: '‚ö†Ô∏è', error: '‚ùå', done: '‚úÖ',
            };

            panel.innerHTML = entries.map(e => {
                const t = new Date(e.time).toLocaleTimeString();
                const icon = typeIcons[e.type] || '‚ñ∏';
                return `<div class="log-entry">
                    <span class="log-time">${t}</span>
                    <span class="log-type log-${e.type}">${icon} ${e.type.toUpperCase()}</span>
                    <span class="log-msg">${esc(e.message)}</span>
                </div>`;
            }).join('');

            document.getElementById('progress-count').textContent = entries.length + ' steps';
            panel.scrollTop = panel.scrollHeight;
        }

        async function checkRunning() {
            try {
                // Poll progress (always ‚Äî shows latest even after done)
                const progRes = await fetch('/api/admin/scrape-progress');
                const progData = await progRes.json();
                if (progData.progress?.length > lastProgressCount) {
                    lastProgressCount = progData.progress.length;
                    renderProgressLog(progData.progress);
                }

                // Check scraper running
                const res = await fetch('/api/admin/scrape-running');
                const d = await res.json();
                const btn = document.getElementById('btn-scrape');
                if (!d.running && btn.classList.contains('running')) {
                    btn.disabled = false;
                    btn.classList.remove('running');
                    btn.innerHTML = 'üîÑ Scrape New Products';
                    document.getElementById('status-msg').textContent = '‚úÖ Scraper finished!';
                    document.getElementById('progress-dot').style.animation = 'none';
                    document.getElementById('progress-dot').style.background = '#6e7681';
                    loadStatus();
                    loadHistory();
                    loadProductStats();
                }

                // Show/hide progress panel
                if (d.running || progData.progress?.length > 0) {
                    document.getElementById('progress-card').style.display = '';
                }

                // Also check price update status
                const upRes = await fetch('/api/admin/update-prices-running');
                const upD = await upRes.json();
                const upBtn = document.getElementById('btn-update');
                if (!upD.running && upBtn.classList.contains('running')) {
                    upBtn.disabled = false;
                    upBtn.classList.remove('running');
                    upBtn.innerHTML = 'üí∞ Update Prices';
                    document.getElementById('update-msg').textContent = '‚úÖ Price update finished!';
                    loadProductStats();
                }
            } catch (e) { }
        }

        // ===== Update Prices =====
        async function updatePrices() {
            const btn = document.getElementById('btn-update');
            const msg = document.getElementById('update-msg');
            btn.disabled = true;
            btn.classList.add('running');
            btn.innerHTML = '‚è≥ Updating...';
            msg.textContent = 'Checking all products for price changes & availability...';
            try {
                const res = await fetch('/api/admin/update-prices', {
                    method: 'POST',
                    headers: apiHeaders(),
                });
                const d = await res.json();
                if (res.ok) {
                    msg.textContent = '‚úÖ ' + d.message;
                } else {
                    msg.textContent = '‚ùå ' + d.error;
                    btn.disabled = false;
                    btn.classList.remove('running');
                    btn.innerHTML = 'üí∞ Update Prices';
                }
            } catch (e) {
                msg.textContent = '‚ùå ' + e.message;
                btn.disabled = false;
                btn.classList.remove('running');
                btn.innerHTML = 'üí∞ Update Prices';
            }
        }

        // ===== Product Stats =====
        async function loadProductStats() {
            try {
                const res = await fetch('/api/admin/product-stats?key=' + encodeURIComponent(adminKey));
                const d = await res.json();
                document.getElementById('p-total').textContent = d.totalProducts?.toLocaleString() || '‚Äî';
                document.getElementById('p-categories').textContent = d.categories?.length || '‚Äî';
                document.getElementById('p-brands').textContent = d.brands?.length || '‚Äî';

                const tbody = document.getElementById('recent-products');
                if (d.recentProducts?.length) {
                    tbody.innerHTML = d.recentProducts.map(p => `
                        <tr>
                            <td style="max-width:250px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(p.product_name)}</td>
                            <td>${esc(p.brand || '‚Äî')}</td>
                            <td style="color:var(--success);font-weight:700">$${p.price?.toFixed(2) || '‚Äî'}</td>
                            <td>${esc(p.category)}</td>
                            <td>${timeAgo(p.created_at)}</td>
                        </tr>`).join('');
                } else {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:var(--text-muted)">No products</td></tr>';
                }
            } catch (e) { }
        }

        // ===== Add Product =====
        async function addProduct() {
            const name = document.getElementById('add-name').value.trim();
            const price = document.getElementById('add-price').value;
            const brand = document.getElementById('add-brand').value.trim();
            const category = document.getElementById('add-category').value;
            const product_type = document.getElementById('add-type').value;
            const condition = document.getElementById('add-condition').value;
            const amazon_url = document.getElementById('add-url').value.trim();
            const msg = document.getElementById('add-product-msg');

            if (!name || !price) {
                msg.textContent = '‚ö†Ô∏è Product name and price are required';
                msg.style.color = 'var(--warning)';
                return;
            }

            const btn = document.getElementById('btn-add-product');
            btn.disabled = true;
            btn.textContent = '‚è≥ Adding...';

            try {
                const res = await fetch('/api/admin/product', {
                    method: 'POST',
                    headers: apiHeaders(),
                    body: JSON.stringify({ product_name: name, price, brand, category, product_type, condition, amazon_url }),
                });
                const d = await res.json();
                if (res.ok) {
                    msg.textContent = '‚úÖ Product added: ' + name;
                    msg.style.color = 'var(--success)';
                    document.getElementById('add-name').value = '';
                    document.getElementById('add-price').value = '';
                    document.getElementById('add-brand').value = '';
                    document.getElementById('add-url').value = '';
                    loadProductStats();
                } else {
                    msg.textContent = '‚ùå ' + d.error;
                    msg.style.color = 'var(--danger)';
                }
            } catch (e) {
                msg.textContent = '‚ùå ' + e.message;
                msg.style.color = 'var(--danger)';
            } finally {
                btn.disabled = false;
                btn.textContent = '‚ûï Add Product';
            }
        }

        // ===== Schedule =====
        async function loadSchedule() {
            try {
                const res = await fetch('/api/admin/schedule?key=' + encodeURIComponent(adminKey));
                const d = await res.json();
                if (d.lastRun) document.getElementById('sch-last').textContent = timeAgo(d.lastRun);
                if (d.nextRun) document.getElementById('sch-next').textContent = fmtDate(d.nextRun);
                if (d.cronExpression) {
                    const sel = document.getElementById('sch-freq');
                    const opts = Array.from(sel.options).map(o => o.value);
                    if (opts.includes(d.cronExpression)) {
                        sel.value = d.cronExpression;
                    } else {
                        sel.value = 'custom';
                        document.getElementById('custom-cron-group').style.display = 'block';
                        document.getElementById('sch-custom-cron').value = d.cronExpression;
                    }
                }
            } catch (e) { }
        }

        function saveSchedule() {
            const freq = document.getElementById('sch-freq').value;
            const customCron = document.getElementById('sch-custom-cron').value;
            const cron = freq === 'custom' ? customCron : freq;
            const msg = document.getElementById('sch-msg');

            if (!cron || cron === 'custom') {
                msg.textContent = '‚ö†Ô∏è Please enter a valid cron expression';
                msg.style.color = 'var(--warning)';
                return;
            }

            const cronLabels = {
                '0 6 * * *': 'Daily at 6 AM UTC',
                '0 */12 * * *': 'Every 12 Hours',
                '0 */6 * * *': 'Every 6 Hours',
                '0 */3 * * *': 'Every 3 Hours',
                '0 8 * * 1': 'Weekly (Mon 8 AM)',
            };
            const label = cronLabels[cron] || cron;
            document.getElementById('sch-current').textContent = label;

            msg.innerHTML = `
                <div style="margin-top:0.5rem;padding:0.75rem;background:var(--bg-primary);border-radius:var(--radius-sm)">
                    <p style="color:var(--success)">‚úÖ Schedule set to: <strong>${label}</strong></p>
                    <p style="margin-top:0.5rem;font-size:0.78rem;color:var(--text-muted)">Update <code>vercel.json</code> crons section to:</p>
                    <code style="display:block;margin-top:0.3rem;padding:0.4rem;background:var(--bg-card);border-radius:4px;font-size:0.75rem">"schedule": "${cron}"</code>
                    <p style="margin-top:0.5rem;font-size:0.78rem;color:var(--text-muted)">Then <code>git push</code> to apply.</p>
                </div>`;
        }

        async function runScheduledScrape() {
            const msg = document.getElementById('sch-msg');
            msg.textContent = '‚è≥ Triggering scrape now...';
            msg.style.color = 'var(--text-secondary)';
            try {
                const res = await fetch('/api/admin/scrape', { method: 'POST', headers: apiHeaders() });
                const d = await res.json();
                if (res.ok) {
                    msg.textContent = '‚úÖ ' + d.message + ' ‚Äî Check Scraper tab for progress.';
                    msg.style.color = 'var(--success)';
                } else {
                    msg.textContent = '‚ùå ' + d.error;
                    msg.style.color = 'var(--danger)';
                }
            } catch (e) {
                msg.textContent = '‚ùå ' + e.message;
                msg.style.color = 'var(--danger)';
            }
        }

        // ===== Blog Generation =====
        function generateBlog() {
            const topic = document.getElementById('blog-topic').value;
            const customTopic = document.getElementById('custom-topic').value;
            const type = document.getElementById('blog-type').value;
            const length = document.getElementById('blog-length').value;
            const instructions = document.getElementById('blog-instructions').value;
            const msg = document.getElementById('blog-status');

            if (!topic) {
                msg.textContent = '‚ö†Ô∏è Please select a topic';
                return;
            }

            const finalTopic = topic === 'custom' ? customTopic : topic;
            if (!finalTopic) {
                msg.textContent = '‚ö†Ô∏è Please enter a custom topic';
                return;
            }

            // Build a prompt for blog generation
            const blogConfig = {
                topic: finalTopic,
                type,
                length,
                instructions,
            };

            msg.innerHTML = `
                <div style="margin-top:1rem;padding:1rem;background:var(--bg-primary);border-radius:var(--radius-sm);font-size:0.82rem">
                    <p>üìù <strong>Blog generation config ready!</strong></p>
                    <p style="margin-top:0.5rem">Topic: <strong>${esc(finalTopic)}</strong></p>
                    <p>Type: ${type} ¬∑ Length: ${length}</p>
                    <p style="margin-top:0.75rem;color:var(--text-muted)">
                        üí° To generate: run the blog generator locally or connect an AI API.<br>
                        Copy this config and use it with your preferred AI writing tool:
                    </p>
                    <code style="display:block;margin-top:0.5rem;padding:0.5rem;background:var(--bg-card);border-radius:4px;font-size:0.75rem;overflow-x:auto">${JSON.stringify(blogConfig, null, 2)}</code>
                </div>`;
        }

        // ===== Blog AI Generation =====
        let currentBlogContent = '';

        document.getElementById('blog-topic').addEventListener('change', (e) => {
            document.getElementById('custom-topic-group').style.display =
                e.target.value === 'custom' ? 'block' : 'none';
        });

        async function generateBlog(auto = false) {
            const status = document.getElementById('blog-status');
            const btn = auto ? document.getElementById('btn-auto-blog') : document.getElementById('btn-blog');
            const origText = btn.textContent;

            let topic = '';
            if (!auto) {
                const sel = document.getElementById('blog-topic').value;
                if (sel === 'custom') topic = document.getElementById('custom-topic').value.trim();
                else topic = sel ? document.getElementById('blog-topic').selectedOptions[0].text : '';
                if (!topic) {
                    status.innerHTML = '<span style="color:var(--warning)">‚ö†Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Topic ‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö</span>';
                    return;
                }
            }

            btn.disabled = true;
            btn.textContent = '‚è≥ AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô...';
            status.innerHTML = '<span style="color:var(--text-muted)">ü§ñ Gemini ‡∏Å‡∏≥‡∏•‡∏±‡∏á generate blog... (~30-60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)</span>';

            try {
                const res = await fetch('/api/admin/generate-blog', {
                    method: 'POST', headers: apiHeaders(),
                    body: JSON.stringify({
                        topic,
                        autoTopic: auto,
                        articleType: document.getElementById('blog-type').value,
                        length: document.getElementById('blog-length').value,
                        instructions: document.getElementById('blog-instructions').value,
                        aiProvider: document.getElementById('blog-ai-provider').value,
                    }),
                });
                const d = await res.json();
                if (d.success) {
                    currentBlogContent = d.content;
                    status.innerHTML = `<span style="color:var(--success)">‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: <strong>${esc(d.topic)}</strong></span>`;
                    document.getElementById('blog-preview-area').style.display = 'block';
                    document.getElementById('blog-preview').textContent = d.content;
                    document.getElementById('blog-word-count').textContent = `${d.wordCount} words`;
                } else {
                    status.innerHTML = `<span style="color:var(--danger)">‚ùå ${d.error}</span>`;
                }
            } catch (e) {
                status.innerHTML = `<span style="color:var(--danger)">‚ùå ${e.message}</span>`;
            } finally {
                btn.disabled = false;
                btn.textContent = origText;
            }
        }

        function copyBlogContent() {
            navigator.clipboard.writeText(currentBlogContent).then(() => {
                const btn = event.target;
                btn.textContent = '‚úÖ Copied!';
                setTimeout(() => btn.textContent = 'üìã Copy', 1500);
            });
        }

        // ===== Blog Publish & Management =====
        async function publishBlog(publishNow) {
            const status = document.getElementById('publish-status');
            if (!currentBlogContent) {
                status.innerHTML = '<span style="color:var(--warning)">‚ö†Ô∏è Generate a blog post first</span>';
                return;
            }

            status.innerHTML = '<span style="color:var(--text-muted)">üíæ Saving...</span>';
            try {
                const res = await fetch('/api/admin/publish-blog', {
                    method: 'POST', headers: apiHeaders(),
                    body: JSON.stringify({
                        content: currentBlogContent,
                        articleType: document.getElementById('blog-type').value,
                        publishNow,
                    }),
                });
                const d = await res.json();
                if (d.success) {
                    const link = publishNow ? ` <a href="/blog/${d.post.slug}" target="_blank" style="color:var(--primary)">‚Üí View Post</a>` : '';
                    status.innerHTML = `<span style="color:var(--success)">${d.message}${link}</span>`;
                    loadBlogPosts();
                } else {
                    status.innerHTML = `<span style="color:var(--danger)">‚ùå ${d.error}</span>`;
                }
            } catch (e) {
                status.innerHTML = `<span style="color:var(--danger)">‚ùå ${e.message}</span>`;
            }
        }

        async function loadBlogPosts() {
            const el = document.getElementById('blog-posts-list');
            if (!el) return;
            try {
                const res = await fetch('/api/admin/blog/list', { headers: apiHeaders() });
                const posts = await res.json();
                if (!posts.length) {
                    el.innerHTML = '<span style="color:var(--text-muted)">No blog posts yet. Generate and publish one above!</span>';
                    return;
                }
                el.innerHTML = posts.map(p => `
                    <div style="display:flex;justify-content:space-between;align-items:center;padding:0.4rem;border-bottom:1px solid var(--border)">
                        <div style="flex:1;min-width:0">
                            <strong style="font-size:0.76rem">${esc(p.title)}</strong>
                            <div style="font-size:0.65rem;color:var(--text-muted);margin-top:0.1rem">
                                ${p.article_type} ¬∑ ${p.word_count} words ¬∑ ${p.published_at ? new Date(p.published_at).toLocaleDateString() : 'Draft'}
                            </div>
                        </div>
                        <div style="display:flex;gap:0.2rem;flex-shrink:0">
                            <span class="badge ${p.is_published ? 'badge-active' : ''}" style="font-size:0.6rem">${p.is_published ? '‚úÖ Live' : 'üìù Draft'}</span>
                            ${p.is_published ? `<a href="/blog/${p.slug}" target="_blank" class="btn" style="font-size:0.6rem;padding:0.15rem 0.3rem">üëÅÔ∏è</a>` : ''}
                            <button class="btn" style="font-size:0.6rem;padding:0.15rem 0.3rem" onclick="toggleBlogPost('${p.id}')">${p.is_published ? '‚è∏Ô∏è' : 'üöÄ'}</button>
                            <button class="btn" style="font-size:0.6rem;padding:0.15rem 0.3rem;color:var(--danger)" onclick="deleteBlogPost('${p.id}')">üóëÔ∏è</button>
                        </div>
                    </div>`).join('');
            } catch (e) {
                el.innerHTML = `<span style="color:var(--danger)">Error: ${e.message}</span>`;
            }
        }

        async function toggleBlogPost(id) {
            try {
                await fetch(`/api/admin/blog/${id}/toggle`, { method: 'PATCH', headers: apiHeaders() });
                loadBlogPosts();
            } catch (e) { alert(e.message); }
        }

        async function deleteBlogPost(id) {
            if (!confirm('Delete this blog post?')) return;
            try {
                await fetch(`/api/admin/blog/${id}`, { method: 'DELETE', headers: apiHeaders() });
                loadBlogPosts();
            } catch (e) { alert(e.message); }
        }

        // ===== X Post AI Generation =====
        let currentXPost = '';

        async function generateXPost() {
            const status = document.getElementById('x-gen-status');
            const btn = document.getElementById('btn-gen-x');
            const origText = btn.textContent;

            btn.disabled = true;
            btn.textContent = '‚è≥ Generating...';
            status.innerHTML = '<span style="color:var(--text-muted)">ü§ñ AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô tweet...</span>';

            try {
                const res = await fetch('/api/admin/generate-x-post', {
                    method: 'POST', headers: apiHeaders(),
                    body: JSON.stringify({
                        postType: document.getElementById('x-gen-type').value,
                        customPrompt: document.getElementById('x-custom-prompt').value,
                        aiProvider: document.getElementById('x-ai-provider').value,
                    }),
                });
                const d = await res.json();
                if (d.success) {
                    currentXPost = d.tweet;
                    status.innerHTML = '<span style="color:var(--success)">‚úÖ Tweet generated!</span>';
                    document.getElementById('x-preview-area').style.display = 'block';
                    document.getElementById('x-preview-text').textContent = d.tweet;
                    document.getElementById('x-char-count').textContent = `${d.charCount}/280 characters`;
                    document.getElementById('x-char-count').style.color = d.charCount > 260 ? 'var(--warning)' : 'var(--text-muted)';
                } else {
                    status.innerHTML = `<span style="color:var(--danger)">‚ùå ${d.error}</span>`;
                }
            } catch (e) {
                status.innerHTML = `<span style="color:var(--danger)">‚ùå ${e.message}</span>`;
            } finally {
                btn.disabled = false;
                btn.textContent = origText;
            }
        }

        function copyXPost() {
            navigator.clipboard.writeText(currentXPost).then(() => {
                const btn = event.target;
                btn.textContent = '‚úÖ Copied!';
                setTimeout(() => btn.textContent = 'üìã Copy', 1500);
            });
        }

        // ===== Helpers =====
        function timeAgo(d) {
            const diff = Date.now() - new Date(d).getTime();
            const m = Math.floor(diff / 60000);
            if (m < 1) return 'Just now';
            if (m < 60) return m + 'm ago';
            const h = Math.floor(m / 60);
            if (h < 24) return h + 'h ago';
            return Math.floor(h / 24) + 'd ago';
        }

        function fmtDate(d) {
            return d ? new Date(d).toLocaleString() : '‚Äî';
        }

        function esc(s) {
            if (!s) return '';
            const d = document.createElement('div');
            d.textContent = s;
            return d.innerHTML;
        }
    </script>
</body>

</html>